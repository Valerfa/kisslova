function tui_editimage(e,i,t){var o,n=document.querySelector(`img[id="${i}"]`).getAttribute("src");window.upload_saveAs=function(e){window.showLoadIcon&&window.showLoadIcon();var o=window.TUWidget.init(document.querySelector(".tui-image-editor-canvas-container"));o.done((function(e){if(e.tuInfo&&e.tuInfo.cdnUrl){var o=e.tuInfo.cdnUrl,n=document.getElementById(i);if(null!=n&&(n.src=o),"function"==typeof t)t(i,e.tuInfo);else if(n){const i=n.closest(".js-image-box"),t=n.closest(".js-gallery-item"),d=!!t,r=undefined;tui_saveimage(d?t:i,o,e,d)}"function"==typeof window.tuiEditor.destroy&&window.tuiEditor.destroy();var d=document.querySelector("#tuiEditorTildaWidget");d&&d.remove(),window.tuiEditor=!1,window.hideLoadIcon&&window.hideLoadIcon(),window.edrec_preview&&window.edrec_preview.update()}})).fail((function(){"function"==typeof window.tuiEditor.destroy&&window.tuiEditor.destroy();var e=document.querySelector("#tuiEditorTildaWidget");e&&e.remove(),window.tuiEditor=!1,window.hideLoadIcon&&window.hideLoadIcon()})),o.uploadFileFromURL(e)},window.tuiEditor&&(document.querySelector(".tui__editor-container").style.display="block"),tui_onReady(n)}function tui_saveimage(e,i,t,o){var n=e.querySelector(".js-img-cdnurl"),d=e.querySelector(".js-img-uuid"),r=e.querySelector(".js-img-name"),a=e.querySelector(".js-img-size"),u=e.querySelector(".js-img-width"),l=e.querySelector(".js-img-height"),c=e.querySelector(".js-img-title");n&&(n.value=i),d&&(d.value=""),r&&(r.value=""),a&&(a.value=""),u&&(u.value=""),l&&(l.value="");var s=i.substring(i.length-30);if(c&&(c.setAttribute("href",i),c.innerHTML=`...${s}`),t.tuInfo.width>0&&u&&(u.value=t.tuInfo.width),o){e.setAttribute("data-src",i);const t=e.closest(".js-gallery-upload-widget");if(!t)return;const o=t.querySelector(".js-gallery-json");if(!o)return;const n=t.querySelectorAll(".js-gallery-item"),d=Array.from(n).map((e=>{const i=undefined;return{img:e.getAttribute("data-src")}}));o.value=JSON.stringify(d)}}function tui_initImageEditor(e){if(e.indexOf("ucarecdn")>0||e.indexOf("tildacdn.info")>0){var i=e.lastIndexOf("/");i!=e.length-1&&(e=e.substring(0,i+1))}else"/"==e.substring(0,1)&&(e=`${window.location.origin}${e}`);var t={includeUI:{menu:["newSize","crop","flip","rotate","text","draw","filter"],loadImage:{path:e,name:"SampleImage"},menuBarPosition:"top",usageStatistics:!1},cssMaxWidth:800,cssMaxHeight:600,usageStatistics:!1};"RU"===window.lang&&(t.includeUI.locale={Undo:"Назад",Redo:"Вперёд",Reset:"Сбросить",Delete:"Удалить","Delete-all":"Удалить всё",Rotate:"Повернуть",Save:"Сохранить",Width:"Ширина",Height:"Высота","Lock proportion":"Сохранить пропорции",Custom:"Произвольный",Crop:"Обрезать",Apply:"Применить",Cancel:"Отменить",Flip:"Развернуть","Flip X":"По горизонтали","Flip Y":"По вертикали",Angle:"Угол",Text:"Добавить текст",Bold:"Жирный",Italic:"Курсив",Underline:"Подчеркнуть",Left:"Влево",Center:"По центру",Right:"Вправо",Color:"Цвет","Text size":"Размер",Draw:"Нарисовать линию",Free:"Свободная",Straight:"Прямая",Size:"Размер",Filter:"Добавить фильтр",Grayscale:"Градации серого",Sepia:"Сепия",Blur:"Размытие",Emboss:"Тиснение",Invert:"Инверсия",Sepia2:"Сепия 2",Sharpen:"Резкость","Remove White":"Удалить белый цвет",Distance:"Расстояние",Value:"Значение",Brightness:"Яркость",Noise:"Шум",Pixelate:"Пикселизация","Color Filter":"Фильтр цвета",Threshold:"Порог"}),window.tuiEditor=new window.tui.ImageEditor("#tui-image-editor-container",t),window.onresize=function(){window.tuiEditor?window.tuiEditor.ui.resizeEditor():setTimeout((function(){window.onresize()}),300)}}function tui_onReady(e){if(window.tuiEditor){var i=e.split("/");window.tuiEditor.loadImageFromURL(e,i?i[i.length-1]:"photo")}else if(window.tuiEditorLoad)tui_addTuiContainer(),tui_initImageEditor(e);else if(!document.querySelector("#tuiEditorTildaScriptVersion")){if(window.tp__loadResource&&window.tp__loadResource("/front/css/tui.min.css"),"RU"===window.lang){var t=document.createElement("style");t.id="tuiEditorStyleRussian",t.textContent=".tui-image-editor-container .color-picker-control .tui-image-editor-range {width: 75px;}.tui-image-editor-container .tui-image-editor-submenu-align:first-child label {width: 95px;}.tui-image-editor-container .tui-image-editor-submenu-align label {width: 75px;}.tui-image-editor-container .tui-image-editor-checkbox-wrap.fixed-width {width: 230px;}",document.documentElement.appendChild(t)}window.tp__loadResource&&window.tp__loadResource("/front/js/tui-im-edit.min.js").then((function(){window.tuiEditorLoad=!0,tui_onReady(e)}))}}function tui_addTuiContainer(){var e=document.querySelector("#tuiEditorTildaWidget");e&&(e&&e.remove(),window.tuiEditor=!1);var i=document.createElement("div"),t;i.id="tuiEditorTildaWidget",i.className="tui__editor-container",i.innerHTML='<div class="tui__editor-fullscreen_bg"></div><div class="tui__editor-wrap"><div class="tui__editor-header"><span>Photo Editor</span><span class="tui__editor-header-close"></span></div><div id="tui-image-editor-container"></div></div>',document.documentElement.appendChild(i),document.querySelector(".tui__editor-header-close").onclick=function(){i.style.display="none",window.tuiEditor=!1,e&&e.remove()}}
