(()=>{"use strict";class t{constructor(t,e){if(!(t instanceof Element))throw new TypeError("TSortable container is not an Element");this._container=t;const s=(e="[object Object]"===Object.prototype.toString.call(e)?e:{}).dragImage||{},n=e.ghost||{},i=e.dropBar||{},a=e.dropArea||{},o=e.autoScroll||{},r=e.nested||{};this._config={containerClassName:e.containerClassName||"tsort",dragImage:{className:s.className||"tsort__drag-image",opacity:!isNaN(s.opacity)&&s.opacity>=0&&s.opacity<=1?s.opacity:1,zIndex:isNaN(s.zIndex)?1e4:s.zIndex,offsetX:isNaN(s.offsetX)?isNaN(s.offset)?10:s.offset:s.offsetX,offsetY:isNaN(s.offsetY)?isNaN(s.offset)?10:s.offset:s.offsetY,appendTo:s.appendTo instanceof Element?s.appendTo:document.body,maxWidth:isNaN(s.maxWidth)?200:s.maxWidth,maxHeight:isNaN(s.maxHeight)?100:s.maxHeight,isRevertAnimation:void 0===s.isRevertAnimation||!!s.isRevertAnimation,counterClassName:s.counterClassName||"tsort__drag-image_counter"},noDropBetweenFromConnectedSortable:!!e.noDropBetweenFromConnectedSortable,nested:{isEnabled:!!r.isEnabled,containerTagName:r.containerTagName||"ul",containerClassName:Array.isArray(r.containerClassName)&&r.containerClassName[0]?r.containerClassName:[r.containerClassName||"tsort__list"],noNestedSelector:r.noNestedSelector||".tsort__item_nonested",noDropInsideSelector:r.noDropInsideSelector||".tsort__item_nodropinside",isExpandEnabled:!!r.isExpandEnabled,expandedClassName:r.expandedClassName||"tsort__item_expanded",noExpandSelector:r.noExpandSelector||".tsort__item_noexpand",expandTimeout:!isNaN(r.expandTimeout)&&r.expandTimeout>=0?r.expandTimeout:700,noNestableSelector:r.noNestableSelector||".tsort__item_nonestable",maxNestedLevel:!isNaN(r.maxNestedLevel)&&r.maxNestedLevel>0?r.maxNestedLevel:0},selector:e.selector||".tsort__item",noBeforeSelector:e.noBeforeSelector||".tsort__item_nobefore",specificSelector:e.specificSelector||".tsort__item_specific",noAfterSelector:e.noAfterSelector||".tsort__item_noafter",cancelSelector:e.cancelSelector||".tsort__item_cancel",handleSelector:e.handleSelector||".tsort__item",multipleSelector:e.multipleSelector||".tsort__item_selected",ghost:{className:n.className||"tsort__ghost",opacity:!isNaN(n.opacity)&&n.opacity>=0&&n.opacity<=1?n.opacity:.3},dropBar:{className:i.className||"tsort__dropbar",visibleClassName:i.visibleClassName||"tsort__dropbar_visible",zIndex:isNaN(i.zIndex)?9999:i.zIndex,overlappingPercent:!isNaN(i.overlappingPercent)&&i.overlappingPercent>=0&&i.overlappingPercent<=.5?i.overlappingPercent:.3,vIndent:!isNaN(i.vIndent)&&i.vIndent>=0?i.vIndent:0,hPadding:!isNaN(i.hPadding)&&i.hPadding>=0?i.hPadding:0},dropArea:{className:a.className||"tsort__droparea",visibleClassName:a.visibleClassName||"tsort__droparea_visible",zIndex:isNaN(a.zIndex)?9998:a.zIndex,vPadding:!isNaN(a.vPadding)&&a.vPadding>=0?a.vPadding:0,hPadding:!isNaN(a.hPadding)&&a.hPadding>=0?a.hPadding:0},autoScroll:{isEnabled:void 0===o.isEnabled||!!o.isEnabled,speedIndex:!isNaN(o.speedIndex)&&o.speedIndex>0?o.speedIndex:1,offset:!isNaN(o.offset)&&o.offset>0?o.offset:60},toleranceDistance:!isNaN(e.toleranceDistance)&&e.toleranceDistance>=0?e.toleranceDistance:6,delay:!isNaN(e.delay)&&e.delay>=0?e.delay:50,touchDelay:!isNaN(e.touchDelay)&&e.touchDelay>=0?e.touchDelay:300,touchDistance:!isNaN(e.touchDistance)&&e.touchDistance>=0?e.touchDistance:20,isAutoUpdateEnabled:!!e.isAutoUpdateEnabled},this._config.autoScroll.container=o.container instanceof Element?o.container:this._getAutoScrollContainer(),this._sortableElements=Array.from(this._container.querySelectorAll(this._config.selector)),this._onStart="function"==typeof e.onStart?e.onStart:function(){},this._onMove="function"==typeof e.onMove?e.onMove:function(){},this._onEnd="function"==typeof e.onEnd?e.onEnd:function(){},this._onBeforeDrop="function"==typeof e.onBeforeDrop?e.onBeforeDrop:function(){},this._onDrop="function"==typeof e.onDrop?e.onDrop:function(){},this._onExpand="function"==typeof e.onExpand?e.onExpand:function(){},this._handlePointerDown=this._handlePointerDown.bind(this),this._handlePointerUp=this._handlePointerUp.bind(this),this._handlePointerMove=this._handlePointerMove.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDrop=this._handleDrop.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._throttledUpdate=this._throttle(this.update,1e3),this._preventDefaultDrag=this._preventDefaultDrag.bind(this),this._preventContextMenu=this._preventContextMenu.bind(this),this._handleExpand=this._handleExpand.bind(this),this._handleTouchStart=this._handleTouchStart.bind(this),this._handleTouchMove=this._handleTouchMove.bind(this),this._handleTouchEnd=this._handleTouchEnd.bind(this),this._pointerState={isButtonPressed:!1,startPosX:null,startPosY:null,startTimestamp:null,targetElement:null},this._isDropped=!1,this._isDisabled=!1,this._isDragStarted=!1,this._dropBarElements=[],this._dropAreaElements=[],this._dragImages=[],this._expandState={targetElement:null,timeoutId:null},this._draggingElements=[],this._connectedSorables=[],this._isDragStartedInConnectedSortable=!1,this._dragStartedSortable=null,this._autoScrollSpeed=0,this._autoScrollAccumulator=0,this._observer=null,this._isTouchDevice=!window.matchMedia("(hover: hover)").matches,this._dragImagePosX=0,this._dragImagePosY=0,this._connectedTo=null}_getAutoScrollContainer(){let t=this._container;const e=["auto","scroll","overlay"];for(;t&&t!==document.documentElement;){const s=window.getComputedStyle(t).getPropertyValue("overflow-y");if(e.includes(s))break;t=t.parentElement}return t||document.documentElement}_getElementsTree(t){const e=new Map(t.map((t=>[t,{element:t,children:[],parent:null}]))),s=[];return t.forEach((t=>{const n=e.get(t);let i=!1,a=t.parentElement;for(;a;){if(e.has(a)){const t=e.get(a);n.parent=t.element,t.children.push(n),i=!0;break}a=a.parentElement}i||s.push(n)})),s}_getDropBarElements(){const t=this._sortableElements.filter((t=>t.offsetHeight)),e=this._getElementsTree(t),s=(t,e)=>{const n=[];if(!t.length)return n;for(let i=0;i<t.length+1;i++){const a=i?t[i-1]:null,o=i<t.length?t[i]:null,r=a?a.element:null,l=o?o.element:null,c=document.createElement("div");c.classList.add(this._config.dropBar.className);const d=document.createElement("div");c.appendChild(d);const h=(l||r).offsetWidth,p=(l||r).offsetLeft,_=this._config.dropBar.vIndent,m=this._config.dropBar.hPadding,g=r&&r.firstElementChild,u=l&&l.firstElementChild;let f=g?g.offsetHeight:0,E=u?u.offsetHeight:0,v=r?r.offsetTop:0,S=r?v+r.offsetHeight:0,y=l?l.offsetTop:0,D=l?y+l.offsetHeight:0;r||(v=e?0:y-_-E,S=y-_,f=S-v),l||(y=S+_,D=e?this._container.scrollHeight:S+_+f,E=D-y);const b=l||!e?this._config.dropBar.overlappingPercent:1,x=r||!e?this._config.dropBar.overlappingPercent:1,N=(y+E*b+S-f*x)/2,A=f*x+E*b+_,I=S+_/2-N+A/2;c.style.display="none",c.style.position="absolute",c.style.transform="translateY(-50%)",c.style.top=N+"px",c.style.width=h+2*m+"px",c.style.left=p-m+"px",c.style.height=A+"px",c.style.zIndex=this._config.dropBar.zIndex,d.style.position="absolute",d.style.transform="translateY(-50%)",d.style.left="0px",d.style.top=I+"px",n.push({dropBarEl:c,prevEl:r,nextEl:l}),a&&a.children.length&&n.push(...s(a.children,!1))}return n};return s(e,!0)}_getDropAreaElements(){const t=this._sortableElements,e=[],s=this._config.dropArea.hPadding,n=this._config.dropArea.vPadding;for(let i=0;i<t.length;i++){const a=t[i],o=a.firstElementChild||a;if(!o.offsetHeight)continue;const r=document.createElement("div");r.classList.add(this._config.dropArea.className),r.style.display="none",r.style.zIndex=this._config.dropArea.zIndex,r.style.position="absolute",r.style.width=o.offsetWidth+2*s+"px",r.style.height=o.offsetHeight+2*n+"px",r.style.top=o.offsetTop-n+"px",r.style.left=o.offsetLeft-s+"px",e.push({dropAreaEl:r,parentEl:a})}return e}_getDragImage(t,e){this._dragImages=[];const s=[],n=this._config.dragImage,i=Math.min(t.length,3);for(let e=i-1;e>=0;e--){const i=t[e].cloneNode(!0),a=t[e].getBoundingClientRect();i.classList.add(n.className),i.style.opacity="0",i.style.zIndex=n.zIndex,i.style.position="fixed",i.style.top="0px",i.style.left="0px",i.style.transformOrigin="left top",i.style.transitionProperty="opacity, transform",i.style.transitionDuration="300ms",i.style.transitionTimingFunction="cubic-bezier(0.87, 0, 0.13, 1)",i.style.translate=`${a.left}px ${a.top}px`,n.appendTo.appendChild(i),this._dragImages.push(i);const o=n.maxWidth/i.offsetWidth,r=n.maxHeight/i.offsetHeight,l=Math.min(o,r)<1?Math.min(o,r):1;s.push(l)}setTimeout((()=>{for(let a=0;a<i;a++){const o=this._dragImages[a],r=t[a].getBoundingClientRect(),l=i-a-1,c=Math.min(...s)*(1-l/10);o.style.transform=`\n                    scale(${c})\n                    translate(\n                        calc(${o.offsetWidth/(1-l/20)}px - 100%),\n                        calc(${o.offsetHeight/(1-l/10)}px - 100% + ${20*l}px)\n                    )\n                `,o.style.opacity=n.opacity*(1-l/10),this._dragImagePosX=e.x+n.offsetX,this._dragImagePosX=e.y+n.offsetY,this._animateDragImagePos(o,{x:r.left,y:r.top},{})}}),0);const a=t.length;if(a>1){const t=document.createElement("div");t.innerText=a,t.classList.add(n.className),t.classList.add(n.counterClassName),t.style.opacity="0",t.style.zIndex=n.zIndex,t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.transformOrigin="left top",t.style.transition="opacity 300ms cubic-bezier(0.87, 0, 0.13, 1)",t.style.translate=`${e.x+n.offsetX}px ${e.y+n.offsetY}px`,this._dragImages.push(t),n.appendTo.appendChild(t),setTimeout((()=>{t.style.opacity=n.opacity}),300)}}_animateDragImagePos(t,e,s,n){const i=performance.now(),a=o=>{const r=(this._dragImagePosX||s.x)-e.x,l=(this._dragImagePosY||s.y)-e.y,c=0===(d=(o-i)/300)?0:1===d?1:d<.5?Math.pow(2,20*d-10)/2:(2-Math.pow(2,-20*d+10))/2;var d;t.style.translate=`${e.x+r*c}px ${e.y+l*c}px`,c<.99?this._dragImageAnimationFrame=requestAnimationFrame(a):(this._dragImageAnimationFrame=null,t.style.translate=`${this._dragImagePosX||s.x}px ${this._dragImagePosY||s.y}px`,"function"==typeof n&&n.call(this))};this._dragImageAnimationFrame=requestAnimationFrame(a)}_disableSelection(){document.body.style.setProperty("user-select","none"),document.body.style.setProperty("-webkit-user-select","none"),document.documentElement.style.cursor="default"}_enableSelection(){document.body.style.removeProperty("user-select"),document.body.style.removeProperty("-webkit-user-select"),document.documentElement.style.removeProperty("cursor")}_setAutoScrollSpeed(t){if(this._autoScrollSpeed=t,this._scrollAnimationFrame&&!t)return cancelAnimationFrame(this._scrollAnimationFrame),this._scrollAnimationFrame=null,void(this._autoScrollAccumulator=0);if(!t)return;const e=this._config.autoScroll.container;let s;const n=t=>{if(this._scrollAnimationFrame&&!this._autoScrollSpeed)return cancelAnimationFrame(this._scrollAnimationFrame),this._scrollAnimationFrame=null,void(this._autoScrollAccumulator=0);if(this._autoScrollSpeed<0&&0===e.scrollTop||this._autoScrollSpeed>0&&e.scrollTop===e.scrollHeight-e.scrollTop)return cancelAnimationFrame(this._scrollAnimationFrame),void(this._scrollAnimationFrame=null);void 0===s&&(s=t);const i=(t-s)/1e3*this._autoScrollSpeed;this._autoScrollAccumulator+=i,(this._autoScrollSpeed>0&&this._autoScrollAccumulator>=1||this._autoScrollSpeed<0&&this._autoScrollAccumulator<=-1)&&(e.scrollTop+=Math.floor(this._autoScrollAccumulator),this._autoScrollAccumulator=0),s=t,this._scrollAnimationFrame=requestAnimationFrame(n)};this._scrollAnimationFrame=requestAnimationFrame(n)}_getNestedLevel(t){const{selector:e}=this._config,s=this._container;let n=0,i=t;do{i=i.parentElement.closest(e),i&&s.contains(i)&&n++}while(i&&s.contains(i));return n}_validateDropBetween(t,e){const s=this._dropBarElements.find((t=>t.dropBarEl===e)),n=s.prevEl,i=s.nextEl,a=this._config.noBeforeSelector,o=this._config.noAfterSelector;if(n&&n.matches(o)||i&&i.matches(a))return!1;const r=this._config.specificSelector;let l=!0;for(let e=0;e<t.length;e++)if(!t[e].matches(r)){l=!1;break}const c=i&&i.matches(r)||!i,d=n&&n.closest(r)||!n;if(l&&!c&&!d||!l&&c&&d)return!1;if(this._config.noDropBetweenFromConnectedSortable&&this._isDragStartedInConnectedSortable)return!1;for(let e=0;e<t.length;e++){if(t[e].contains(n)||t[e].contains(i))return!1;if(n===t[e]||i===t[e])return!1}const{containerClassName:h,noNestableSelector:p,maxNestedLevel:_}=this._config.nested;if(p&&t.some((t=>t.matches(p)))){const t=`.${h}`,e=!(!n||!n.closest(t)),s=!(!i||!i.closest(t));if(e||s)return!1}if(_){const e=[...t].map((t=>[t,...t.querySelectorAll(this._config.selector)])).flat().map(this._getNestedLevel.bind(this)),s=Math.max(...e)-Math.min(...e),a=n&&this._getNestedLevel(n)||0,o=i&&this._getNestedLevel(i)||0;if(a+s>_||o+s>_)return!1}return!0}_validateDropInside(t,e){const s=this._dropAreaElements.find((t=>t.dropAreaEl===e)).parentEl,{noNestedSelector:n,noDropInsideSelector:i,noNestableSelector:a,maxNestedLevel:o}=this._config.nested;if(s.closest(n))return!1;if(t.some((t=>t.matches(a))))return!1;for(let e=0;e<t.length;e++){if(t[e].contains(s))return!1;if(t[e].matches(i))return!1}if(o){const e=[...t].map((t=>[t,...t.querySelectorAll(this._config.selector)])).flat().map(this._getNestedLevel.bind(this)),n=Math.max(...e)-Math.min(...e);if((s&&this._getNestedLevel(s)||0)+n>=o)return!1}return!0}_handleExpand(t){if(this._onExpand.call(null,t),this._expandState.targetElement=null,this._expandState.timeoutId=null,t.defaultPrevented)return;const e=t.targetEl;e&&e.classList.add(this._config.nested.expandedClassName),this.update()}_enableAutoUpdate(){const t=this._container;this._observer=new MutationObserver((t=>{const e=[];t.forEach((t=>{e.push(...Array.from(t.addedNodes),...Array.from(t.removedNodes))}));for(let t=0;t<e.length;t++){const s=e[t];if(s.nodeType===Node.ELEMENT_NODE&&s.matches(this._config.selector)){this.update();break}}})),this._observer.observe(t,{childList:!0,subtree:!0})}_preventContextMenu(t){const e=this._config.selector,s=this._config.cancelSelector;this._isDisabled||!t.target.closest(e)||t.target.closest(s)||(t.preventDefault(),t.stopPropagation())}_preventDefaultDrag(t){t.target.closest&&t.target.closest(this._config.selector)&&(t.preventDefault(),t.stopPropagation())}_throttle(t,e){var s=this;let n=null;return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];n||(n=window.setTimeout((()=>{t.apply(s,a),window.clearTimeout(n),n=null}),e))}}init(){this._isDragStarted=!1,this._container.classList.add(this._config.containerClassName),this._container.style.position="relative",this._dropBarElements=this._getDropBarElements(),this._dropBarElements.forEach((t=>this._container.appendChild(t.dropBarEl))),this._config.nested.isEnabled&&(this._dropAreaElements=this._getDropAreaElements(),this._dropAreaElements.forEach((t=>this._container.appendChild(t.dropAreaEl)))),this._isTouchDevice?(document.addEventListener("touchstart",this._handleTouchStart),document.addEventListener("touchmove",this._handleTouchMove,{passive:!1}),document.addEventListener("touchend",this._handleTouchEnd),window.addEventListener("contextmenu",this._preventContextMenu,{passive:!1,capture:!0})):(document.addEventListener("mousedown",this._handlePointerDown),document.addEventListener("mousemove",this._handlePointerMove),document.addEventListener("mouseup",this._handlePointerUp)),this._container.addEventListener("tDragStart",this._handleDragStart),this._container.addEventListener("tDragMove",this._handleDragMove),this._container.addEventListener("tDragEnd",this._handleDragEnd),this._container.addEventListener("tDrop",this._handleDrop),this._container.addEventListener("tExpand",this._handleExpand),document.addEventListener("dragstart",this._preventDefaultDrag,{passive:!1,capture:!0}),this._isTouchDevice&&this._sortableElements.forEach((t=>{t.style.setProperty("user-select","none"),t.style.setProperty("-webkit-touch-callout","none")})),window.addEventListener("resize",this._throttledUpdate),this._config.isAutoUpdateEnabled&&this._enableAutoUpdate()}update(){this._sortableElements=Array.from(this._container.querySelectorAll(this._config.selector)),this._isTouchDevice&&this._sortableElements.forEach((t=>{t.style.setProperty("user-select","none"),t.style.setProperty("-webkit-touch-callout","none")})),this._dropBarElements.forEach((t=>t.dropBarEl.remove())),this._dropBarElements=this._getDropBarElements(),this._dropBarElements.forEach((t=>this._container.appendChild(t.dropBarEl))),this._dropAreaElements.forEach((t=>t.dropAreaEl.remove())),this._dropAreaElements=[],this._config.nested.isEnabled&&(this._dropAreaElements=this._getDropAreaElements(),this._dropAreaElements.forEach((t=>this._container.appendChild(t.dropAreaEl)))),(this._isDragStarted||this._isDragStartedInConnectedSortable)&&(this._dropBarElements.forEach((t=>{if(this._validateDropBetween(this._draggingElements,t.dropBarEl)){t.dropBarEl.firstElementChild.style.opacity="0",t.dropBarEl.style.display="block"}})),this._dropAreaElements.forEach((t=>{this._validateDropInside(this._draggingElements,t.dropAreaEl)&&(t.dropAreaEl.style.opacity="0",t.dropAreaEl.style.display="block",this._expandState.targetElement&&this._expandState.targetElement===t.parentEl&&(t.dropAreaEl.classList.add(this._config.dropArea.visibleClassName),t.dropAreaEl.style.opacity="1"))})))}disable(){this._isDisabled=!0}enable(){this._isDisabled=!1}destroy(){this._observer&&this._observer.disconnect(),this._container.classList.remove(this._config.containerClassName),this._container.style.removeProperty("position"),this._isTouchDevice?(document.removeEventListener("touchstart",this._handleTouchStart),document.removeEventListener("touchmove",this._handleTouchMove,{passive:!1}),document.removeEventListener("touchend",this._handleTouchEnd),window.removeEventListener("contextmenu",this._preventContextMenu,{passive:!1,capture:!0})):(document.removeEventListener("mousedown",this._handlePointerDown),document.removeEventListener("mousemove",this._handlePointerMove),document.removeEventListener("mouseup",this._handlePointerUp)),this._container.removeEventListener("tDragStart",this._handleDragStart),this._container.removeEventListener("tDragMove",this._handleDragMove),this._container.removeEventListener("tDragEnd",this._handleDragEnd),this._container.removeEventListener("tDrop",this._handleDrop),document.removeEventListener("dragstart",this._preventDefaultDrag,{passive:!1,capture:!0}),this._isTouchDevice&&this._sortableElements.forEach((t=>{t.style.removeProperty("user-select"),t.style.removeProperty("-webkit-touch-callout")})),window.removeEventListener("resize",this._throttledUpdate),this._dropBarElements.forEach((t=>t.dropBarEl.remove())),this._dropAreaElements.forEach((t=>t.dropAreaEl.remove()))}connect(e){if(!(e instanceof t))throw new TypeError("Connecting object is not an instance of TSortable");if(e._connectedSorables.find((t=>t===this)))throw new Error("This TSortable is already connected");this._connectedSorables.find((t=>t===e))||(this._connectedSorables.push(e),e._connectedTo=this,e._container.addEventListener("tDragStart",this._handleDragStart),e._container.addEventListener("tDragMove",this._handleDragMove),e._container.addEventListener("tDragEnd",this._handleDragEnd),e._container.addEventListener("tDrop",this._handleDrop))}disconnect(t){const e=this._connectedSorables.indexOf(t);-1!==e&&(this._connectedSorables.splice(e,1),t._container.removeEventListener("tDragStart",this._handleDragStart),t._container.removeEventListener("tDragMove",this._handleDragMove),t._container.removeEventListener("tDragEnd",this._handleDragEnd),t._container.removeEventListener("tDrop",this._handleDrop),t._connectedTo=null,this._isDragStartedInConnectedSortable=!1,this._dragStartedSortable=null)}_handlePointerDown(t){this._isDisabled||this._isDragStarted||this._pointerState.isButtonPressed||1!==t.buttons||!t.target.closest(this._config.handleSelector)||!this._container.contains(t.target)||t.target.closest(this._config.selector).matches(this._config.cancelSelector)||(this._disableSelection(),this._pointerState.isButtonPressed=!0,this._pointerState.startPosX=t.clientX,this._pointerState.startPosY=t.clientY,this._pointerState.startTimestamp=performance.now(),this._pointerState.targetElement=t.target.closest(this._config.selector))}_handlePointerMove(t){if(this._isDisabled)return;1!==t.buttons&&(this._pointerState.isButtonPressed=!1);const e=this._pointerState.startPosX||0,i=this._pointerState.startPosY||0,a=t.clientX,o=t.clientY,r=Math.sqrt(Math.pow(a-e,2)+Math.pow(o-i,2)),l=this._pointerState.startTimestamp||0,c=performance.now()-l;if(this._isDragStarted&&1===t.buttons){const e=new n(this,t);this._container.dispatchEvent(e)}else if(!this._isDragStarted&&1===t.buttons&&this._pointerState.isButtonPressed&&r>=this._config.toleranceDistance&&c>=this._config.delay){this.update(),this._isDragStarted=!0;const e=new s(this,t);this._container.dispatchEvent(e)}else;}_handlePointerUp(t){if(!this._isDisabled){if(this._pointerState.isButtonPressed=!1,this._enableSelection(),this._isDragStarted||this._isDragStartedInConnectedSortable){const e=this._config.dropBar.className,s=this._config.dropArea.className,{target:n}=t,o=n&&n.closest&&n.closest("."+e),r=n&&n.closest&&n.closest("."+s),l=this._dropBarElements.find((t=>t.dropBarEl===o)),c=this._dropAreaElements.find((t=>t.dropAreaEl===r));if(l||c){const e=new a(this,t);this._container.dispatchEvent(e),this._isDropped=!0}if(!this._isDragStartedInConnectedSortable){const e=new i(this,t);this._container.dispatchEvent(e)}}this._pointerState.startPosX=null,this._pointerState.startPosY=null,this._pointerState.startTimestamp=null,this._pointerState.targetElement=null}}_handleTouchStart(t){this._isDisabled||this._isDragStarted||this._pointerState.isButtonPressed||1!==t.touches.length||!t.target.closest(this._config.handleSelector)||!this._container.contains(t.target)||t.target.closest(this._config.selector).matches(this._config.cancelSelector)||(this._disableSelection(),this._pointerState.isButtonPressed=!0,this._pointerState.startPosX=t.touches[0].clientX,this._pointerState.startPosY=t.touches[0].clientY,this._pointerState.startTimestamp=performance.now(),this._pointerState.targetElement=t.target.closest(this._config.selector))}_handleTouchMove(t){if(!this._isDisabled)if(this._isDragStarted){t.cancelable&&t.preventDefault();const e=new n(this,t);this._container.dispatchEvent(e)}else if(this._pointerState.isButtonPressed){const e=performance.now(),n=this._pointerState.startPosX,i=this._pointerState.startPosY,a=t.changedTouches[0].clientX,o=t.changedTouches[0].clientY,r=Math.sqrt(Math.pow(a-n,2)+Math.pow(o-i,2)),l=e-this._pointerState.startTimestamp;if(t.cancelable&&r<this._config.touchDistance&&l>=this._config.touchDelay){t.preventDefault(),this.update(),this._isDragStarted=!0;const e=new s(this,t);this._container.dispatchEvent(e)}}}_handleTouchEnd(t){if(!this._isDisabled){if(this._pointerState.isButtonPressed=!1,this._enableSelection(),this._isDragStarted||this._isDragStartedInConnectedSortable){const e=this._config.dropBar.className,s=this._config.dropArea.className,n=t.changedTouches[0].clientX,o=t.changedTouches[0].clientY,r=document.elementFromPoint(n,o),l=r&&r.closest("."+e),c=r&&r.closest("."+s),d=this._dropBarElements.find((t=>t.dropBarEl===l)),h=this._dropAreaElements.find((t=>t.dropAreaEl===c));if(d||h){const e=new a(this,t);this._container.dispatchEvent(e),this._isDropped=!0}if(!this._isDragStartedInConnectedSortable){const e=new i(this,t);this._container.dispatchEvent(e)}}this._pointerState.startPosX=null,this._pointerState.startPosY=null,this._pointerState.startTimestamp=null,this._pointerState.targetElement=null}}_handleDragStart(t){if(this._isTouchDevice&&"function"==typeof window.navigator.vibrate&&window.navigator.vibrate(10),this._isDragStarted||(this._isDragStartedInConnectedSortable=!0,this._dragStartedSortable=t.tSortable),this._onStart.call(null,t),this._draggingElements=t.draggingElements,this._isDragStartedInConnectedSortable&&(this._draggingElements=this._dragStartedSortable._draggingElements),this._dropBarElements.forEach((t=>{if(this._validateDropBetween(this._draggingElements,t.dropBarEl)){t.dropBarEl.firstElementChild.style.opacity="0",t.dropBarEl.style.display="block"}})),this._dropAreaElements.forEach((t=>{this._validateDropInside(this._draggingElements,t.dropAreaEl)&&(t.dropAreaEl.style.opacity="0",t.dropAreaEl.style.display="block")})),this._isDragStartedInConnectedSortable)return;this._getDragImage(this._draggingElements,t.dragStartPos);const e=this._config.ghost.className,s=this._config.ghost.opacity;this._draggingElements.forEach((t=>{t.classList.add(e),t.style.opacity=s,t.style.pointerEvents="none"}))}_handleDragMove(t){let e,s,n;this._onMove.call(null,t),t.originalEvent.type.includes("touch")?(e=t.originalEvent.changedTouches[0].clientX,s=t.originalEvent.changedTouches[0].clientY,n=document.elementFromPoint(e,s)):(e=t.originalEvent.clientX,s=t.originalEvent.clientY,n=t.originalEvent.target),this._isDragStartedInConnectedSortable||(this._dragImageAnimationFrame?(this._dragImagePosX=e+this._config.dragImage.offsetX,this._dragImagePosY=s+this._config.dragImage.offsetY):this._dragImages.forEach((t=>{t.style.translate=`${e+this._config.dragImage.offsetX}px ${s+this._config.dragImage.offsetY}px`})));const i=this._config.dropBar.className,a=this._config.dropBar.visibleClassName,r=n&&n.closest&&n.closest("."+i);if(r&&!r.classList.contains(a)&&this._isTouchDevice&&"function"==typeof window.navigator.vibrate&&window.navigator.vibrate(10),this._dropBarElements.forEach((t=>{t.dropBarEl.classList.remove(a);t.dropBarEl.firstElementChild.style.opacity="0"})),r){r.classList.add(a);r.firstElementChild.style.opacity="1"}if(this._config.nested.isEnabled){const t=this._config.dropArea.className,e=this._config.dropArea.visibleClassName,s=n&&n.closest("."+t);if(s&&!s.classList.contains(e)&&this._isTouchDevice&&"function"==typeof window.navigator.vibrate&&window.navigator.vibrate(10),this._dropAreaElements.forEach((t=>{t.dropAreaEl.classList.remove(e),t.dropAreaEl.style.opacity="0"})),s){s.classList.add(e),s.style.opacity="1";const t=this._dropAreaElements.find((t=>t.dropAreaEl===s)),n=t&&t.parentEl,i=this._config.nested;this._expandState.timeoutId&&this._expandState.targetElement!==n&&(window.clearTimeout(this._expandState.timeoutId),this._expandState.timeoutId=null,this._expandState.targetElement=null),this._expandState.timeoutId||!i.isExpandEnabled||!n||n.matches(i.noExpandSelector)||n.classList.contains(i.expandedClassName)||(this._expandState.targetElement=n,this._expandState.timeoutId=window.setTimeout((()=>{const t=new o(n);this._container.dispatchEvent(t)}),i.expandTimeout))}else this._expandState.timeoutId&&(window.clearTimeout(this._expandState.timeoutId),this._expandState.timeoutId=null,this._expandState.targetElement=null)}const l=this._config.autoScroll,c=l.container;if(this._isDragStartedInConnectedSortable&&this._dragStartedSortable._config.autoScroll.container===c)return;if(!l.isEnabled)return;const d=c.getBoundingClientRect(),h=Math.max(d.top,0),p=Math.min(d.bottom,document.documentElement.clientHeight),_=s-h-l.offset,m=p-s-l.offset,g=l.speedIndex;_<0?this._setAutoScrollSpeed(g*Math.pow(_,3)/5e3):m<0?this._setAutoScrollSpeed(-1*g*(Math.pow(m,3)/5e3)):this._setAutoScrollSpeed(0)}_handleDragEnd(t){if(this._setAutoScrollSpeed(0),this._isDragStartedInConnectedSortable||this._onEnd.call(null,t),this._draggingElements=[],this._expandState.timeoutId&&(window.clearTimeout(this._expandState.timeoutId),this._expandState.timeoutId=null,this._expandState.targetElement=null),this._dropBarElements.forEach((t=>{t.dropBarEl.style.display="none";t.dropBarEl.firstElementChild.style.opacity="0"})),this._dropAreaElements.forEach((t=>{t.dropAreaEl.style.display="none",t.dropAreaEl.style.opacity="0"})),this._isDragStartedInConnectedSortable)return this._isDragStartedInConnectedSortable=!1,void(this._dragStartedSortable=null);const e=this._connectedTo&&this._connectedTo._isDropped||!1;this._dragImages&&this._dragImages.length&&(this._dragImages.forEach(((s,n)=>{if(s.style.opacity="0",!this._config.dragImage.isRevertAnimation||this._isDropped||e||s.matches("."+this._config.dragImage.counterClassName)){let t=getComputedStyle(s).getPropertyValue("transition-duration");t.indexOf("ms")+1?(t=t.replace("ms",""),t=parseInt(t,10)):t.indexOf("s")+1?(t=t.replace("s",""),t=1e3*parseFloat(t)):t=0,setTimeout((()=>{s.remove()}),t||0)}else{s.style.transform="none";const e=t.draggingElements[n].getBoundingClientRect(),i=s.style.getPropertyValue("translate").replace(/px/g,"").split(" ").map((t=>parseFloat(t)));this._dragImagePosX=0,this._dragImagePosY=0,this._animateDragImagePos(s,{x:i[0],y:i[1]},{x:e.left,y:e.top},(()=>s.remove()))}})),this._dragImages=[]),this._isDropped=!1,this._isDragStarted=!1;const s=this._config.ghost.className;t.draggingElements.forEach((t=>{t.style.removeProperty("opacity"),t.style.removeProperty("pointer-events"),t.classList.remove(s)}))}_handleDrop(t){this._isTouchDevice&&"function"==typeof window.navigator.vibrate&&window.navigator.vibrate(10);const e=t.relativeTargets,s=t.draggingElements,n=this._config.nested;if(!(this._isDragStartedInConnectedSortable&&(e.nextEl&&!this._container.contains(e.nextEl)||e.prevEl&&!this._container.contains(e.prevEl)||e.parentEl&&!this._container.contains(e.parentEl))||(this._onBeforeDrop.call(null,t),t.defaultPrevented))){if(s.forEach((t=>{const e=t.closest(n.containerTagName+"."+n.containerClassName);t.remove(),e&&!e.firstElementChild&&e.remove()})),e.nextEl)s.forEach((t=>{e.nextEl.insertAdjacentElement("beforebegin",t)}));else if(e.prevEl)for(let t=s.length-1;t>=0;t--)e.prevEl.insertAdjacentElement("afterend",s[t]);else if(e.parentEl){let t=e.parentEl.querySelector(n.containerTagName+"."+n.containerClassName.join("."));t?s.forEach((e=>{t.appendChild(e)})):(t=document.createElement(n.containerTagName),t.classList.add(...n.containerClassName),s.forEach((e=>{t.appendChild(e)})),e.parentEl.appendChild(t))}this._config.isAutoUpdateEnabled||this.update(),window.setTimeout(this._onDrop.bind(null,t),0)}}}class e extends CustomEvent{constructor(t,e,s){super(s,{cancelable:!0}),this.originalEvent=e;const{_pointerState:n}=t;if("tDragEnd"!==s&&"tDrop"!==s){const e=n.targetElement;e.matches(t._config.multipleSelector)?this.draggingElements=Array.from(t._container.querySelectorAll(t._config.multipleSelector)):this.draggingElements=[e]}this.dragStartPos={x:n.startPosX,y:n.startPosY},this.dragStartTimestamp=n.startTimestamp,this.tSortable=t}}class s extends e{constructor(t,e){super(t,e,"tDragStart")}}class n extends e{constructor(t,e){super(t,e,"tDragMove")}}class i extends e{constructor(t,e,s){super(t,e,s||"tDragEnd");const n=t._draggingElements;t._isDragStartedInConnectedSortable&&t._connectedSorables.forEach((t=>{const e=t._draggingElements;n.push(...e)})),this.draggingElements=n}}class a extends i{constructor(t,e){super(t,e,"tDrop");const s=t._config.dropBar.className,n=t._config.dropArea.className;let i;if(e.type.includes("touch")){const t=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY;i=document.elementFromPoint(t,s)}else i=e.target;const a=i&&i.closest("."+s)||null,o=i&&i.closest("."+n)||null;if(a){this.placementMethod="between";const e=t._dropBarElements.find((t=>t.dropBarEl===a));this.relativeTargets={prevEl:e?e.prevEl:null,nextEl:e?e.nextEl:null,parentEl:null}}else if(o){this.placementMethod="inside";const e=t._dropAreaElements.find((t=>t.dropAreaEl===o));this.relativeTargets={prevEl:null,nextEl:null,parentEl:e?e.parentEl:null}}else this.placementMethod=null,this.relativeTargets={prevEl:null,nextEl:null,parentEl:null}}}class o extends CustomEvent{constructor(t){super("tExpand",{cancelable:!0}),this.targetEl=t}}window.TSortable=t})();